<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>6-Minuten-Gehtest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; background: #f4f4f4; }
    h1 { text-align: center; }
    label, input, button { display: block; width: 100%; margin: 10px 0; font-size: 16px; }
    #result { margin-top: 20px; font-weight: bold; font-size: 18px; }
  </style>
</head>
<body>
  <h1>6-Minuten-Gehtest Normwert-Rechner</h1>
  <label for="distance">Zurückgelegte Distanz (in Metern):</label>
  <input type="number" id="distance" required>

  <label for="age">Alter (in Jahren):</label>
  <input type="number" id="age" required>

  <label for="height">Körpergröße (in cm):</label>
  <input type="number" id="height" required>

  <button onclick="calculatePercentile()">✅ Normwert berechnen</button>

  <div id="result"></div>

  <script>
    const rawPercentiles = {
      150: {
        30: [436, 470, 511, 555, 592, 631, 679],
        40: [434, 468, 509, 553, 590, 629, 677],
        50: [414, 448, 489, 533, 570, 609, 656],
        60: [364, 397, 439, 483, 520, 558, 606],
        70: [313, 347, 388, 432, 469, 508, 556],
        80: [281, 313, 355, 399, 436, 475, 523]
      },
      160: {
        30: [455, 489, 530, 574, 611, 650, 697],
        40: [453, 487, 528, 572, 609, 648, 695],
        50: [433, 466, 508, 552, 588, 627, 675],
        60: [382, 416, 457, 501, 538, 577, 625],
        70: [332, 366, 407, 451, 488, 526, 574],
        80: [300, 332, 374, 418, 455, 493, 541]
      },
      170: {
        30: [474, 507, 549, 593, 629, 668, 716],
        40: [472, 505, 546, 590, 627, 666, 714],
        50: [451, 485, 526, 570, 607, 646, 694],
        60: [401, 435, 476, 520, 557, 595, 643],
        70: [351, 384, 425, 469, 506, 545, 593],
        80: [319, 351, 393, 437, 474, 513, 561]
      },
      180: {
        30: [492, 526, 567, 611, 648, 687, 735],
        40: [490, 524, 565, 609, 646, 685, 733],
        50: [470, 503, 545, 589, 626, 664, 712],
        60: [419, 453, 494, 538, 575, 614, 662],
        70: [369, 403, 444, 488, 525, 564, 611],
        80: [337, 369, 411, 455, 492, 530, 578]
      },
      190: {
        30: [511, 544, 586, 630, 667, 705, 753],
        40: [509, 542, 584, 628, 665, 703, 751],
        50: [488, 522, 563, 607, 644, 683, 731],
        60: [438, 472, 513, 557, 594, 633, 680],
        70: [388, 421, 463, 507, 544, 582, 630],
        80: [356, 388, 430, 474, 511, 549, 597]
      }
    };

    function interpolate(val, lower, upper, wLower, wUpper) {
      return wLower * val[lower] + wUpper * val[upper];
    }

    function findNearestBounds(value, array) {
      const sorted = [...array].sort((a, b) => a - b);
      for (let i = 0; i < sorted.length - 1; i++) {
        if (value >= sorted[i] && value <= sorted[i + 1]) {
          return [sorted[i], sorted[i + 1]];
        }
      }
      return value < sorted[0] ? [sorted[0], sorted[0]] : [sorted[sorted.length - 2], sorted[sorted.length - 1]];
    }

    function calculatePercentile() {
      const dist = parseFloat(document.getElementById("distance").value);
      const age = parseFloat(document.getElementById("age").value);
      const height = parseFloat(document.getElementById("height").value);
      const result = document.getElementById("result");

      const heights = Object.keys(rawPercentiles).map(Number);
      const [hLow, hHigh] = findNearestBounds(height, heights);
      const hWeight = (height - hLow) / (hHigh - hLow);

      const ages = Object.keys(rawPercentiles[hLow]).map(Number);
      const [aLow, aHigh] = findNearestBounds(Math.min(age, 80), ages);
      const aWeight = (Math.min(age, 80) - aLow) / (aHigh - aLow);

      const percentiles = [2.5, 10, 25, 50, 75, 90, 97.5];
      const interpolated = percentiles.map((_, i) => {
        const h1a1 = rawPercentiles[hLow][aLow][i];
        const h1a2 = rawPercentiles[hLow][aHigh][i];
        const h2a1 = rawPercentiles[hHigh][aLow][i];
        const h2a2 = rawPercentiles[hHigh][aHigh][i];

        const lowAge = h1a1 + (h1a2 - h1a1) * aWeight;
        const highAge = h2a1 + (h2a2 - h2a1) * aWeight;

        return lowAge + (highAge - lowAge) * hWeight;
      });

      let percentile = "<2.5";
      for (let i = 0; i < interpolated.length; i++) {
        if (dist < interpolated[i]) {
          percentile = `zwischen ${percentiles[i - 1] || 0} und ${percentiles[i]}%`;
          break;
        }
      }

      const msg = age > 80
        ? "<br><strong>Achtung:</strong> Werte basieren auf Interpolation oberhalb des bekannten Bereichs."
        : "";

      result.innerHTML = `Die gemessene Distanz liegt im Bereich: <strong>${percentile}</strong>${msg}`;
    }
  </script>
</body>
</html>
